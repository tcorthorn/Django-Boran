{% extends "boran_app/base.html" %}
{% block title %}Generar Balance Inicial{% endblock %}
{% block content %}

<style>
  .card { border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
  .card-header { background: #417690; color: #fff; font-weight: 600; border-radius: 10px 10px 0 0; }
  .btn-primary { background: #417690; border-color: #417690; }
  .btn-primary:hover { background: #2c6ba0; border-color: #2c6ba0; }
  .btn-danger { background: #dc3545; }
  .table th { background: #f8f9fa; }
  .badge-success { background: #28a745; }
  .badge-secondary { background: #6c757d; }
</style>

<div class="container py-4">
  <h1 class="mb-4">üìã Gesti√≥n de Balance Inicial por A√±o</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message|safe }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="row">
    <!-- Estado actual -->
    <div class="col-md-6 mb-4">
      <div class="card h-100">
        <div class="card-header">üìä Balance Inicial Existente</div>
        <div class="card-body">
          {% if annos_con_balance %}
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>A√±o</th>
                  <th>Registros</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody>
                {% for anno in annos_con_balance %}
                <tr>
                  <td><strong>{{ anno }}</strong></td>
                  <td><span class="badge bg-success">{{ conteo_por_anno|default_if_none:0 }}</span> cuentas</td>
                  <td>
                    <form action="{% url 'eliminar_balance_inicial_anno' %}" method="post" style="display:inline;" 
                          onsubmit="return confirm('¬øSeguro que quieres eliminar el Balance Inicial de {{ anno }}?');">
                      {% csrf_token %}
                      <input type="hidden" name="anno" value="{{ anno }}">
                      <button type="submit" class="btn btn-sm btn-outline-danger">üóëÔ∏è Eliminar</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="text-muted">No hay Balance Inicial creado para ning√∫n a√±o.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Generar nuevo -->
    <div class="col-md-6 mb-4">
      <div class="card h-100">
        <div class="card-header">‚ûï Generar Balance Inicial Nuevo A√±o</div>
        <div class="card-body">
          <p class="text-muted mb-3">
            Esto calcular√° los saldos finales del a√±o anterior y los usar√° como balance de apertura del nuevo a√±o.
          </p>
          
          <form action="{% url 'generar_balance_inicial' %}" method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label for="anno_destino" class="form-label"><strong>A√±o para crear Balance Inicial:</strong></label>
              <select name="anno_destino" id="anno_destino" class="form-select" style="max-width: 150px;">
                <option value="2026" {% if anno_sugerido == 2026 %}selected{% endif %}>2026</option>
                <option value="2027" {% if anno_sugerido == 2027 %}selected{% endif %}>2027</option>
              </select>
            </div>
            
            <div class="alert alert-info">
              <small>
                <strong>üí° Nota:</strong> Si seleccionas 2026, se tomar√°n los saldos finales de 2025 
                (al 31/12/2025) como punto de partida.
              </small>
            </div>
            
            <button type="submit" class="btn btn-primary">
              üîÑ Generar Balance Inicial
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3">
    <a href="{% url 'home' %}" class="btn btn-secondary">‚Üê Volver al Panel</a>
  </div>
</div>

{% endblock %}
